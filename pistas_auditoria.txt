CREATE TABLE pistasauditoria (
  id serial NOT NULL,
  tabla character(45) NOT NULL,
  accion char(25) NOT NULL,
  datosantiguos text,
  datosnuevos text,
  fechamodificacion timestamp without time zone NOT NULL,
  nick character(45) NOT NULL,
  usuariobd character(45) NOT NULL,
  CONSTRAINT id PRIMARY KEY (id));

CREATE OR REPLACE FUNCTION logs() RETURNS trigger AS
$$
BEGIN
  IF (TG_OP = 'DELETE') THEN
	INSERT INTO pistasauditoria (tabla,accion,datosantiguos,datosnuevos,fechamodificacion,nick,usuariobd)
	VALUES (TG_TABLE_NAME, 'Eliminado', OLD, NULL, now(),'user_nick', USER);
	RETURN OLD;
	
  ELSIF (TG_OP = 'UPDATE') THEN
	INSERT INTO pistasauditoria (tabla,accion,datosantiguos,datosnuevos,fechamodificacion,nick,usuariobd)
	VALUES (TG_TABLE_NAME, 'Actualizado', OLD, NEW, now(),'user_nick', USER);
	RETURN NEW;
	
  ELSIF (TG_OP = 'INSERT') THEN
	INSERT INTO pistasauditoria (tabla,accion,datosantiguos,datosnuevos,fechamodificacion,nick,usuariobd)
	VALUES (TG_TABLE_NAME, 'Insertado', NULL, NEW, now(),'user_nick', USER);
	RETURN NEW;
  END IF;
  
  RETURN NULL;
END;
$$
LANGUAGE 'plpgsql' VOLATILE COST 100;

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON actividad_economica FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON afp FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON area FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON bienes_hogar FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON buros FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON capacidad_pago FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON categoria_foto FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON codeudor FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON control_documentos FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON actividad_economica FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON conyugue FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON credito FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON croquis_direccion FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON cuentas_documentos_cobrar FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON cuentas_por_pagar FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON datos_empresa FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON deposito_bancario FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON destino_credito FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON detalle_ctrol_analisis FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON detalle_ctrol_documentacion FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON direccion FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON efectivos_caja FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON entidad_bancaria FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON estado_civil FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON extension_ci FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON foto FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON garante FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON garantia FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON gastos_familiares FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON gastos_operativos_comercializacion FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON ingreso_mensual FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON inmueble FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON inventario_mercaderia FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON inversiones_financieras FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON mano_obra_mensual FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON maquinaria_equipo FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON nacionalidad FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON notifications FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON otros_activos FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON persona FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON prestamo_bancario FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON profesion FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON referencias_solicitante FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON reporte_buro FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON requisitos FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON rol FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON seguimiento FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_amortizacion FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_contrato FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_credito FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_deposito FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_garantia FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_moneda FOR EACH ROW
EXECUTE PROCEDURE public.logs();


CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_periodo_pago FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON tipo_vivienda FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON users FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON vehiculo FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON venta_comercializacion_productos FOR EACH ROW
EXECUTE PROCEDURE public.logs();

CREATE TRIGGER auditaje
AFTER INSERT OR UPDATE OR DELETE
ON ventas FOR EACH ROW
EXECUTE PROCEDURE public.logs();


